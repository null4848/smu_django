/*! @kyobobook/kbb-js v1.0.10 (build 20250618-103334) */
"use strict";!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.__KbbJS__=e():(t.__KbbJS__=t.__KbbJS__||{},t.__KbbJS__["plugins.ui-marketing-popup"]=e())}(self,(function(){return(self.webpackChunk_KbbJS_=self.webpackChunk_KbbJS_||[]).push([[301],{74510:function(t,e,n){n.r(e),n.d(e,{default:function(){return g}});var i=n(35820),s=n.n(i),a=n(51956),o=n(82324),r=n(96526);function u(){const t=(0,r.ut)({id:"popMarketingAgree",class:"dialog_wrap marketing_agree"}).append(h);return $("body").append(t),t}function h(){return[(0,r.ut)("dialog_contents").append(['<h1 class="hidden">마케팅 수신동의</h1>',(0,r.ut)("title_wrap title_size_md").append('<p class="title_heading">유용한 정보와 할인혜택을 놓치지 마세요!</p>'),(0,r.ut)("marketing_agree_list","ul").append([l("new","새로 들어온 책 / 상품 정보 알림"),l("sale","쇼핑 혜택 및 할인정보 알림"),l("culture","다양한 문화생활 정보 알림")])]),(0,r.ut)("dialog_footer").append([(0,r.ut)({class:"btn_md btn_light_gray",id:"disagreeBtn",html:'<span class="text">나중에 할게요</span>'},"button"),(0,r.ut)({class:"btn_md btn_primary",id:"agreeBtn",html:'<span class="text">동의합니다</span>'},"button")])]}function l(t,e){return(0,r.ut)("agree_item","li").append([(0,r.ut)("ico_agree_".concat(t),"span"),(0,r.ut)("agree_info").append('<span class="info_title">'.concat(e,"</span>"))])}function p(){const t=u.call(this).one("dialogcreate",((t,e)=>{this._dialog=$(t.target).dialog("instance"),this.init(),this.initialized=!0}));this.ui.dialog("#"+t.attr("id"))}class c extends o.ht{constructor(t,e,n){super(t,e,n),this.initOptions(),this._dialog=null,this._date="",this._pushSiteCode="001",p.call(this)}initOptions(){Object.assign(this.options,{elements:{root:"#popMarketingAgree",checkBox:"#marketingAgree01",btn:{agree:"#agreeBtn",disagree:"#disagreeBtn"}}})}get $root(){const{elements:t}=this.options,e=null==t?void 0:t.root;if(null!==e)return $(e)}get date(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1,i=t.getDate();return this._date=e+"년 "+n+"월 "+i+"일",this._date}get pushSiteCode(){return this._pushSiteCode}get dialog(){return this._dialog}init(){this.createElement(),this.bindEvents()}bindEvents(){this.getElement("agreeBtn").on("click",(t=>{this.updatePush("Y")})),this.getElement("disagreeBtn").on("click",(t=>{this.updatePush("N")}))}setMobiPushSet(t){const e={pushType:"event",pushYn:t};return this.mobi.request("setPushSettings",e)}createElement(){var t,e;const{elements:n}=this.options;this.setElement("agreeCheckBox",this.$root.find(null==n?void 0:n.checkBox)),this.setElement("agreeBtn",this.$root.find(null==n||null===(t=n.btn)||void 0===t?void 0:t.agree)),this.setElement("disagreeBtn",this.$root.find(null==n||null===(e=n.btn)||void 0===e?void 0:e.disagree))}updatePush(t){const e="/api".concat((0,r._7)("api.urls.myr.app.push")),n={pushRcmsAgrmYsno:t,pushRcmsPatrCode:"002",pushSiteCode:this.pushSiteCode};return this.$http(e,{method:"PUT",body:n}).then((e=>{const n="Y"===t?"마케팅 수신에 동의하셨습니다.</br>수신동의 일시 : ".concat(this.date):"마케팅 수신에 동의하지 않으셨습니다.</br>수신 미동의 일시 : ".concat(this.date);this.setMobiPushSet(t),this.dialog.close(),setTimeout((()=>{this.ui.toast(n)}))}))}}class d extends a.UiPluginsModule{constructor(){super("marketing-popup"),this._list=[],this._eventYn="NONE"}get list(){return this._list}createDialog(t){if(!this.initialized)return this.ready((()=>this.createDialog(t)));const e=this.getInstance("popMarketingAgree");return null!=e?s().resolve(e):new c(this,"popMarketingAgree",t).ready().then((t=>t.dialog.open()))}init(t){this.ua.isMobileApp&&(this.on("callbackGetPushSettings",(e=>{let{data:n}=e;if(this._eventYn!==n.eventYn){const t={pushType:"event",pushYn:this._eventYn};return this.mobi.request("setPushSettings",t)}if("NONE"===n.eventYn)return this.createDialog(t)})),this.getAppPushConfig().then((t=>{null==t||t.forEach((t=>{"002"===t.pushRcmsPatrCode&&(this._eventYn=t.pushRcmsAgrmYsno)})),this.mobi.request("getPushSettings")})))}getInstance(t){return this.list.find((e=>{let{id:n}=e;return n===t}))}async getAppPushConfig(){try{const t="/api".concat((0,r._7)("api.urls.myr.app.push"))+"?pushSiteCode=001";return(await this.$http(t,{method:"GET"})).data}catch(t){}}}var g=new d}},function(t){return t.O(0,[321,160,712],(function(){return e=74510,t(t.s=e);var e})),t.O()}])}));